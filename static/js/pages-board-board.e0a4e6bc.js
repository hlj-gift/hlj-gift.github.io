(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-board-board"],{2368:function(t,e,n){"use strict";(function(t){n("6a54"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("c9b5"),n("bf0f"),n("ab80"),n("dc8a"),n("5c47"),n("2c10"),n("23f4"),n("7d2f"),n("9c4e"),n("5ef2"),n("aa9c"),n("f7a5");var i=getApp(),a=t.database(),r=i.globalData,o=n("235a"),s=n("7033").cbq,u=n("70b4"),c=n("25bf"),l=null,f={data:function(){return{login:!1,account:"",password:"",autologin:!1,info:r.info,users:[],usercopy:[],currentIndex:0,currentTime:-1,currentTimestr:"",timeRemain:"",lastTime:-1,lastload:!1}},onLoad:function(){l=this;var t=uni.getStorageSync("STOREKEY2");t&&t.account&&(l.account=t.account,t.password&&(l.password=t.password,l.autologin=!0)),r.info||uni.reLaunch({url:"/pages/get/get"})},onUnload:function(){l.handle&&clearInterval(l.handle)},methods:{findLastGroup:function(t){var e=(new Date).getTime();for(var n in t){var i=t[n],a=u.parseDateString(i).getTime();if(e>=a&&e-a<288e5)return n}return-1},findFirstGroup:function(t){var e=(new Date).getTime();for(var n in t){var i=t[n],a=u.parseDateString(i).getTime();if(e>=a){if(e-a<36e5)return n}else if(a-e<36e5)return-2-n}return-1},mask:function(t){return"*******"+t.toString().substring(t.length-4)},prepareData:function(){var t=Object.keys(l.info.location);return t},setauto:function(t){l.autologin=!l.autologin},scrolluser:function(){l.handle=setInterval((function(){l.currentIndex>=l.usercopy.length-1?l.currentIndex=0:l.currentIndex+=1,console.log(l.currentIndex,l.usercopy.length)}),500)},clearHandle:function(){l.handle&&(clearInterval(l.handle),l.handle=!1)},refreshda:function(){if(l.login){l.users=[];var t,e=l.findFirstGroup(r.info.datetime);if(e<0){if(-1!=e){l.currentTime=e,l.currentTimestr=r.info.datetime[-2-l.currentTime];var n=u.parseDateString(l.currentTimestr);return l.clearHandle(),void(l.handle=setInterval((function(){var t=(n-(new Date).getTime())/1e3;l.timeRemain=c.timeFormat(t),t<=1.9&&(l.clearHandle(),l.refreshda())}),1e3))}uni.showToast({title:"暂无场次"}),l.clearHandle();var i=l.findLastGroup(r.info.datetime);if(-1==i)return;l.lastload=!0,l.lastTime=i}e>0?(l.lastload=!1,l.currentTime=e,t=r.info.datetime[e]):t=r.info.datetime[l.lastTime],console.log(t);a.command.aggregate;s(a.collection("Gdata").aggregate().match({group:new RegExp(t+".*","i")}).end(),{success:function(t){var e=[],n=l.prepareData();for(var i in t.data){var a=t.data[i],r=l.info.reward[a.group];if(r){var o=[];for(var s in r)-1!=n.indexOf(r[s])&&o.push([s,r[s]]);for(var s in o){var u=o[s],c=a.users[a.successIndex[u[0]]];c?e.push({index:s,_id:a._id,id:c,reward:u[1],store:l.info.location[u[1]],time:a.group,checked:!!a.checked&&a.checked["m"+c]}):c="未发放"}}}l.clearHandle(),l.users=e,l.usercopy=e.slice(),l.scrolluser()}})}},logincheck:function(){if("admin"!=l.account)uni.showToast({title:"错误",icon:"error"});else{uni.showLoading({mask:!0});s(a.collection("Ginfo").doc(l.account).get(),{success:function(t){if(uni.hideLoading(),t.data[0]){var e=t.data[0].pwd;if(o.hash.auth(l.password,e,"8fdeaa2948ecce44a582e5dbb1e5251f"))return uni.setStorage({key:"STOREKEY2",data:{account:l.account,password:l.autologin?l.password:""}}),l.login=!0,void l.refreshda()}uni.showToast({title:"错误",icon:"error"})},fail:function(t){uni.hideLoading(),uni.showToast({title:"错误",icon:"error"})}})}}}};e.default=f}).call(this,n("861b")["default"])},"25bf":function(t,e,n){var i=n("bdbb").default;n("5c47"),n("a1c1"),n("64aa"),n("aa9c"),n("c9b5"),n("bf0f"),n("ab80"),n("e966"),n("fd3c"),t.exports={dateFormat:function(t){return this.formatTime(t)},timeFormat:function(t,e){if("number"!=typeof t)return"";var n=Math.floor(t/60);return t=Math.floor(t%60),t<10&&(t="0"+t),e?n=Math.floor(n/60)+":"+(n%60<10?"0"+n%60:n%60):n<10&&(n="0"+n),n+":"+t},evalSizeStr:function(t){if("number"!=typeof t)return"";var e=0;while(t>=1024)e++,t/=1024;return t.toFixed(2)+["B","KB","MB","GB"][e]},sort:function(t,e,n,a,r){var o=0,s=0,u=0;if("object"!=i(t))return t;if(0==t.length)return t;for("boolean"!==typeof n&&(n=!0),o=0;o<t.length;o++)for(s=0;s<t.length;s++)a?(n?t[o][e].length>t[s][e].length:t[o][e].length<t[s][e].length)&&(u=t[o],t[o]=t[s],t[s]=u):((n?t[o][e]>t[s][e]:t[o][e]<t[s][e])||t[o][e]==t[s][e]&&r&&(n?t[o][r]>t[s][r]:t[o][r]<t[s][r]))&&(u=t[o],t[o]=t[s],t[s]=u);return t},showFail:function(t){uni.hideLoading({success:function(t){}}),uni.showModal({title:"错误",content:t.errMsg,showCancel:!1})},transTimes:function(t,e,n,i){if("string"!=typeof t)return"";if(""==t)return"";"boolean"!=typeof e&&(e=!1),"boolean"!=typeof n&&(n=!0),"string"!=typeof i&&(i=" "),"D"==t.substr(0,1)&&(t=t.substr(1));var a=t.split(" ")[1],r=a.split(":")[0]+":"+a.split(":")[1],s=new Date(t.replace(/-/g,"/")),u=new Date,c=u.getTime()-s.getTime(),l=(Math.floor(c/864e5),c%864e5),f=Math.floor(l/36e5),d=l%36e5,p=Math.floor(d/6e4),v=d%6e4,g=(Math.round(v/1e3),a.split(":")),h=Number(g[0]),m=new Date;m.setHours(0),m.setMinutes(0),m.setSeconds(0),m.setMilliseconds(0);var w=m.getTime()-s.getTime(),y=Math.floor(w/864e5);if(!n){if(c<0)return o(e,t,"未来",i);if(c<36e5)return o(e,t,c<12e4?"刚刚":p+"分钟前",i);if(c<18e6)return o(e,t,f+"小时"+p+"分钟前",i);if(y<2){var x="";switch(y){case-1:x="今天";break;case 0:x="昨天";break;case 1:x="前天";break}return o(e,t,x+" "+r,i)}var b=u.getDay()||7,T=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1-b).getTime(),S=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1-b-7).getTime(),D=s.getTime();return D>=T?o(e,t,this.getWeekDay(s.getDay())+" "+r,i):D>=S?o(e,t,"上"+this.getWeekDay(s.getDay())+" "+r,i):t}if(c<0)return o(e,t,"未来",i);if(c<36e5)return o(e,t,c<12e4?"刚刚":p+"分钟前",i);if(c<18e6)return o(e,t,f+"小时"+p+"分钟前",i);if(y<2){x="";switch(y){case-1:x="今天";break;case 0:x="昨天";break;case 1:x="前天";break}return o(e,t,x+this.getTimeText(h),i)}b=u.getDay()||7,T=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1-b).getTime(),S=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1-b-7).getTime(),D=s.getTime();return D>=T?o(e,t,this.getWeekDay(s.getDay())+this.getTimeText(h),i):D>=S?o(e,t,"上"+this.getWeekDay(s.getDay()),i):t},getTimeText:function(t){var e="";return t>=0&&t<2?e+="午夜":t>=2&&t<4?e+="凌晨":t>=4&&t<6?e+="黎明":t>=6&&t<8?e+="清晨":t>=8&&t<11?e+="上午":t>=11&&t<13?e+="中午":t>=13&&t<16?e+="下午":t>=16&&t<19?e+="傍晚":t>=19&&t<22?e+="晚上":t>=22&&t<24&&(e+="深夜"),e},getWeekDay:function(t){switch(t){case 0:return"周日";case 1:return"周一";case 2:return"周二";case 3:return"周三";case 4:return"周四";case 5:return"周五";case 6:return"周六";case 7:return"周日";default:return""}},textLen:function(t,e){return t.length<e?t:t.substr(0,e-3)+"..."},listNameVaild:function(t,e,n,i){if(""==n||void 0==n)return!1;for(var a=t,r=0;r<a.length;r++)if(a[r][e]==n)return!1;for(r=0;r<a.length;r++)if(a[r][e]==n&&a.ui_options[r][e]!=i)return!1;return!0},formatTime:function(t){var e=a(new Date(t)).split("/").join("-");return e},getTime:function(t,e,n){"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!0),"undefined"==typeof n&&(n=!1);var i=a(new Date);return t&&!e?i.split(" ")[0].split("/").join("-"):!t&&e?n?i.split(" ")[1].split(":").join("-"):i.split(" ")[1]:t&&e?n?i.split(" ")[0].split("/").join("-")+"-"+i.split(" ")[1].split(":").join("-"):i.split(" ")[0].split("/").join("-")+" "+i.split(" ")[1]:void 0},isTimeLimit:function(t,e,n){"number"!=typeof e&&(e=10),"number"!=typeof tmp_PullDownLimitTime[t]&&(tmp_PullDownLimitTime[t]=0);var i=(new Date).getTime();return i-tmp_PullDownLimitTime[t]<1e3*e?(uni.stopPullDownRefresh({success:function(t){}}),n&&uni.showModal({showCancel:!1,title:"时间限制",content:n+"，请"+(e-(i-tmp_PullDownLimitTime[t])/1e3+1).toFixed(0)+"秒后再试"}),!1):(tmp_PullDownLimitTime[t]=i,!0)},backCycle:function(t,e){var n=t%e;return n<0&&(n+=e),n},numberFixed:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,n=Math.pow(10,e);return Math.floor(t*n)/n},colorTran:function(t,e){if("RGB"!=t){var n=e.R/255,i=e.G/255,a=e.B/255,r=Math.max(n,i,a),o=Math.min(n,i,a),s=r-o,u=0;0===s?u=0:r===n?u=(i-a)/s%6*60:r===i?u=60*((a-n)/s+2):r===a&&(u=60*((n-i)/s+4)),u=Math.floor(this.backCycle(u,360));var c=this.numberFixed((r+o)/2),l=0===s?0:this.numberFixed(s/(1-Math.abs(2*c-1)));return{Y:u,U:360*l,V:360*c}}var f=e.Y,d=e.U/360,p=e.V/360,v=(1-Math.abs(2*p-1))*d,g=v*(1-Math.abs(f/60%2-1)),h=p-v/2,m=[];f>=0&&f<60?m.push(v,g,0):f>=60&&f<120?m.push(g,v,0):f>=120&&f<180?m.push(0,v,g):f>=180&&f<240?m.push(0,g,v):f>=240&&f<300?m.push(g,0,v):f>=300&&f<=360&&m.push(v,0,g);var w=m[0],y=m[1],x=m[2],b=255*(w+h),T=255*(y+h),S=255*(x+h);return{R:b,G:T,B:S}},colorString:function(t,e){var n=["R","G","B"];if("string"==t){for(var i="#",a=0;a<3;a++){var r=parseInt(e[n[a]],10).toString(16);1==r.length&&(r="0"+r),i+=r}return i}var o={R:0,G:0,B:0};for(a=0;a<3;a++)o[n[a]]=parseInt(e.substring(2*a+1,2*a+3),16);return o},colorAlpha:function(t,e){var n=this.colorString("obj",t);return"rgba("+n.R+","+n.G+","+n.B+","+e+")"},touchStartPoint:[0,0],touchEndPoint:[0,0],touchStartTime:0,touchEndTime:0,lastTapTime:0,lastTapTimeoutFunc:null,JudgeDoubleTap:function(t){var e=t.e,n=t.bindtap,i=t.binddoubletap,a=e.timeStamp,r=this.lastTapDiffTime;this.lastTapDiffTime=a;var o=a-r;o<300?(clearTimeout(this.lastTapTimeoutFunc),"function"==typeof i&&i(e)):this.lastTapTimeoutFunc=setTimeout((function(){"function"==typeof n&&n(e)}),300)}};var a=function(t){var e=t.getFullYear(),n=t.getMonth()+1,i=t.getDate(),a=t.getHours(),o=t.getMinutes(),s=t.getSeconds();return[e,n,i].map(r).join("/")+" "+[a,o,s].map(r).join(":")},r=function(t){return t=t.toString(),t[1]?t:"0"+t};function o(t,e,n,i){return"string"!=typeof i&&(i=" "),t?n+i+e:n}},"4cab":function(t,e,n){var i=n("cbeb");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=n("967d").default;a("13ce0230",i,!0,{sourceMap:!1,shadowMode:!1})},"5a7d":function(t,e,n){"use strict";var i=n("4cab"),a=n.n(i);a.a},"63d8":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticStyle:{display:"flex","justify-content":"center","align-items":"center"}},[t.login?i("v-uni-view",{staticStyle:{"justify-self":"center"}},[i("v-uni-view",{staticStyle:{width:"1080px",height:"800px",overflow:"scroll"}},[t.currentTime>-1||t.lastTime>-1?[i("v-uni-view",{staticStyle:{margin:"30rpx",display:"flex","justify-content":"space-around","align-items":"flex-start"}},[i("v-uni-view",{staticStyle:{width:"500px"}},[i("v-uni-view",{staticClass:"headline2",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.refreshda.apply(void 0,arguments)}}},[t._v("老道外·新食尚 5元美食盲盒")]),i("v-uni-view",{staticClass:"headline"},[t._v(t._s(t.currentTime>-1?"本场":t.info.datetime[t.lastTime]+" ")+"中奖用户"),i("v-uni-view",{staticStyle:{"font-size":"40rpx"}},[t._v("奖品")])],1),t._l(t.usercopy,(function(e,n){return e&&"未发放"!=e.id&&t.currentIndex<=n?i("v-uni-view",{staticClass:"item",class:e.index%2==0?"clas2":""},[i("v-uni-view",{staticStyle:{width:"40%"}},[t._v(t._s(t.mask(e.id)))]),i("v-uni-view",{staticStyle:{width:"60%","text-align":"right"}},[t._v(t._s(e.store)+" "+t._s(e.reward))])],1):t._e()})),t._l(t.usercopy,(function(e,n){return e&&"未发放"!=e.id&&t.currentIndex>n?i("v-uni-view",{staticClass:"item",class:e.index%2==0?"clas2":""},[i("v-uni-view",{staticStyle:{width:"40%"}},[t._v(t._s(t.mask(e.id)))]),i("v-uni-view",{staticStyle:{width:"60%","text-align":"right"}},[t._v(t._s(e.store)+" "+t._s(e.reward))])],1):t._e()}))],2),i("v-uni-view",{staticStyle:{width:"500px"}},[t.usercopy.length<60&&t.currentTime>-1?i("v-uni-view",[i("v-uni-view",{staticStyle:{"text-align":"right","font-size":"25rpx"}},[t._v(t._s(t.usercopy.length)+"/60")]),i("v-uni-image",{staticStyle:{width:"500px",height:"750px"},attrs:{src:n("c928"),mode:"aspectFit"}})],1):i("v-uni-view",{staticStyle:{"flex-direction":"column","text-align":"center",display:"flex","align-items":"center",height:"800px","justify-content":"center"}},[i("v-uni-image",{staticStyle:{width:"300px",height:"300px"},attrs:{src:t.info.gift_url}}),i("v-uni-view",{staticStyle:{"font-size":"50rpx"}},[t._v("本场盲盒抽奖已结束，请等待下个时段 ❤")]),i("v-uni-rich-text",{staticStyle:{"margin-top":"200rpx","font-size":"30rpx"},attrs:{nodes:t.info.regulation}})],1)],1)],1)]:[i("v-uni-view",{staticStyle:{"flex-direction":"column","text-align":"center",display:"flex","align-items":"center",height:"800px","justify-content":"center"}},[i("v-uni-image",{staticStyle:{width:"300px",height:"300px"},attrs:{src:t.info.gift_url},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.refreshda.apply(void 0,arguments)}}}),-1!=t.currentTime?i("v-uni-view",{staticStyle:{"font-size":"50rpx"}},[t._v("本场盲盒活动即将于 "+t._s(t.currentTimestr)+" 开始"),i("v-uni-view",{staticStyle:{"font-size":"35rpx","margin-top":"50rpx"}},[t._v(t._s(t.timeRemain))])],1):i("v-uni-view",{staticStyle:{"font-size":"50rpx"}},[t._v("本场盲盒抽奖已结束，请等待下个时段 ❤")]),i("v-uni-rich-text",{staticStyle:{"margin-top":"200rpx","font-size":"30rpx"},attrs:{nodes:t.info.regulation}})],1)]],2),i("v-uni-view",{staticStyle:{height:"250rpx"}})],1):i("v-uni-view",{staticStyle:{padding:"30rpx"}},[i("v-uni-input",{attrs:{placeholder:"账户"},model:{value:t.account,callback:function(e){t.account=e},expression:"account"}}),i("v-uni-input",{staticStyle:{"margin-top":"20rpx"},attrs:{password:!0,placeholder:"密码"},model:{value:t.password,callback:function(e){t.password=e},expression:"password"}}),i("v-uni-view",{staticStyle:{display:"flex","justify-content":"flex-start","align-items":"center","font-size":"25rpx","margin-top":"20rpx"}},[i("v-uni-icon",{attrs:{type:t.autologin?"success":"circle"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setauto.apply(void 0,arguments)}}}),i("v-uni-view",{staticStyle:{"margin-left":"10rpx"}},[t._v("记住密码")])],1),i("v-uni-button",{staticStyle:{"margin-top":"20rpx"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.logincheck.apply(void 0,arguments)}}},[t._v("登录")])],1)],1)},a=[]},c928:function(t,e,n){t.exports=n.p+"static/qrr.jpg"},cbeb:function(t,e,n){var i=n("c86c");e=i(!1),e.push([t.i,"uni-page-body[data-v-077355cd]{background-color:#64100e;color:#fff}body.?%PAGE?%[data-v-077355cd]{background-color:#64100e}.clas2[data-v-077355cd]{background-color:#881717}uni-view[data-v-077355cd]{font-size:%?26?%}.headline[data-v-077355cd]{display:flex;justify-content:space-between;font-size:%?40?%;border-bottom:1px solid #666;padding:%?10?% %?30?%}.headline2[data-v-077355cd]{margin-top:%?50?%;display:flex;justify-content:center;font-size:%?50?%;padding:%?10?% %?30?%}.item[data-v-077355cd]{display:flex;justify-content:space-between;padding:%?10?% %?30?%}",""]),t.exports=e},d37a9:function(t,e,n){"use strict";n.r(e);var i=n("2368"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(r);e["default"]=a.a},ebc8:function(t,e,n){"use strict";n.r(e);var i=n("63d8"),a=n("d37a9");for(var r in a)["default"].indexOf(r)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(r);n("5a7d");var o=n("828b"),s=Object(o["a"])(a["default"],i["b"],i["c"],!1,null,"077355cd",null,!1,i["a"],void 0);e["default"]=s.exports}}]);